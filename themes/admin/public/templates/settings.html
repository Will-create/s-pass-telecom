<div data-jc-controller="Settings" data-jc-scope="settings">

	<br />
	<div class="container">
		<div class="panel">
			<label>@(Paramètre Général)</label>
			<div class="panelbody">
				<div class="row">
					<div class="col-md-4 col-sm-4 m">
						<div data-jc="textbox" data-jc-path="form.url" data-jc-config="required:true;placeholder:@(ex: https://eshop.totaljs.com)">@(Adresse URL)</div>
					</div>
					<div class="col-md-4 col-sm-4 m">
						<div data-jc="textbox" data-jc-path="form.emailcontactform" data-jc-config="required:true;type:email">@(Email pour le formulaire de contact )</div>
					</div>
					<div class="col-md-4 col-sm-4 m">
						<div data-jc="textbox" data-jc-path="form.emailorderform" data-jc-config="required:true;type:email">@(Email pour le formulaire de commande)</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-4 col-sm-4 m">
						<div data-jc="textbox" data-jc-path="form.emailuserform" data-jc-config="required:true;type:email">@(Email pour le formulaire d'utilisateur)</div>
					</div>
					<div class="col-md-4 col-sm-4 m">
					<div data-jc="textbox" data-jc-path="form.emailreply" data-jc-config="required:true;type:email">@(Email pour les réponses)</div>
					</div>
					<div class="col-md-4 col-sm-4 m">
						<div data-jc="textbox" data-jc-path="form.emailsender" data-jc-config="required:true;type:email">@(Email pour l'envoi)</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<br />
	<br />
	<div class="container">
		<div class="panel">
			<label>@(Livraison et paiement)</label>
			<div class="panelbody bg-yellow">
				<div class="row">
					<div class="col-md-6 col-sm-6 m">
						<div class="m" data-jc="textbox" data-jc-path="form.defaultorderstatus" data-jc-config="required:true">@(Un stat par défaut pour les commandes)</div>
						<div class="row">
							<div class="col-md-4">
								<div data-jc="textbox" data-jc-path="form.currency" data-jc-config="align:center;maxlength:10;required:true;placeholder:EUR">@(Monaie)</div>
							</div>
						</div>
						<div class="help">@(Supporte) <code>EUR</code>, <code>USD</code>, <code>GBP</code>, <code>JPY</code>, <code>CZK</code> and <code>FCFA</code></div>
					</div>
					<div class="col-md-6 col-sm-6 m">
						<div data-jc="textboxlist" data-jc-path="form.deliverytypes" class="m" data-jc-config="icon:truck;placeholder:@(Saisir une valeur et taper sur Entrer)">@(Types de livraison)</div>
						<div data-jc="textboxlist" data-jc-path="form.paymenttypes" class="m" data-jc-config="icon:credit-card;placeholder:@(Saisir une valeur et taper sur Entrer)">@(Type de  paiement)</div>
					</div>
				</div>
			</div>
			<hr class="nmt" />
			<div class="panelbody">
				<div class="b"><i class="fa fa-paypal mr5"></i><b class="blue">PayPal</b> Express Checkout</div>
				<br />
				<div class="row">
					<div class="col-md-4 col-sm-4 m">
						<div data-jc="textbox" data-jc-path="form.paypaluser">@(Nom d'utilisateur)</div>
					</div>
					<div class="col-md-4 col-sm-4 m">
						<div data-jc="textbox" data-jc-path="form.paypalpassword">@(Mot de passe)</div>
					</div>
					<div class="col-md-4 col-sm-4 m">
						<div data-jc="textbox" data-jc-path="form.paypalsignature">@(Signature)</div>
					</div>
				</div>
				<div data-jc="checkbox" data-jc-path="form.paypaldebug">@(Activer <b>un mode test pour paypal</b>)</div>
			</div>
		</div>
	</div>
	<br />
	<br />

	<div class="bg-yellow" data-b="user" data-b-visible="value.sa === true">
		<br />
		<br />
		<div class="container">
			<div class="row">
				<div class="col-md-3 col-sm-4 m">
					<h3><i class="fa fa-file-text-o"></i>@(Models)</h3>
				</div>
				<div class="col-md-9 col-sm-8 m">
					<div data-jc="keyvalue" data-jc-path="form.templates" data-jc-value="{}" data-jc-config="icon:file-text-o;placeholderkey:@(Un nom de model);placeholdervalue:@(Saisir le nom d'une vue)">@(Models de page)</div>
					<br />
					<div data-jc="keyvalue" data-jc-path="form.templatesnewsletters" data-jc-value="{}" data-jc-config="icon:file-text-o;placeholderkey:@(Un nom de model);placeholdervalue:@(Saisir le nom d'une vue))">@(Models de newsletter)</div>
					<br />
					<div data-jc="keyvalue" data-jc-path="form.templatesposts" data-jc-value="{}" data-jc-config="icon:file-text-o;placeholderkey:@(Un nom de model);placeholdervalue:@(Saisir le nom d'une vue)e)">@(Models de post)</div>
					<br />
					<div data-jc="keyvalue" data-jc-path="form.templatesproducts" data-jc-value="{}" data-jc-config="icon:file-text-o;placeholderkey:@(Un nom de model);placeholdervalue:@(Saisir le nom d'une vue))">@(Models de produits)</div>
					<br />
					<div class="help nmt"><i class="fa fa-warning"></i>@(Tous les models doivent être manuellement créés dans le dossier suivant <code>/themes/THEME_NAME/views/cms/</code>.)</div>
				</div>
			</div>
		</div>
		<hr />
		<div class="container">
			<div class="row">
				<div class="col-md-3 col-sm-4 m">
					<h3><i class="fa fa-folder-o"></i>@(Catégories)</h3>
				</div>
				<div class="col-md-9 col-sm-8 m">
					<div data-jc="keyvalue" data-jc-path="form.navigations" data-jc-config="icon:sitemap;placeholderkey:@(Un nom d'une navigation);placeholdervalue:@(Saisir le nom d'un indicateur et taper sur entrer)">@(Navigations déja existantes)</div>
					<div class="help">@(Variable Globale: <code>F.global.navigation.IDENTIFICATOR</code>)</div>
					<br />
					<div data-jc="keyvalue" data-jc-path="form.notices" data-jc-config="icon:folder-o;placeholderkey:@(Un nom de notice);placeholdervalue:@(Saisir le nom d'un indicateur et taper sur entrer)">@(Catégorie notices)</div>
					<div class="help">@(Variables Globale: <code>F.global.notices</code>)</div>
					<br />
					<div data-jc="keyvalue" data-jc-path="form.posts" data-jc-config="icon:folder-o;placeholderkey:@(Un nom de post );placeholdervalue:@(Saisir le nom d'un indicateur et taper sur entrer)">@(Catégories de post)</div>
					<div class="help">@(Variables Globale: <code>F.global.posts</code>)</div>
					<br />
					<div data-jc="keyvalue" data-jc-path="form.signals" data-jc-config="icon:dot-circle-o;placeholderkey:@(Un nom de signal);placeholdervalue:@(Saisir le nom d'un indicateur et taper sur entrer)">@(Les signaux enregistrés)</div>
					<div class="help">@(Les signaux peuvent affecter un comportement dans les ages ou les produits)</div>
				</div>
			</div>
			<hr />
			<div data-jc="textarea" data-jc-path="form.defaultcategories" data-jc-config="height:150;icon:folder-o;placeholder:@(Niveau 1 / Niveau 2 / Niveau 3)" class="ui-textarea-code">@(Catégories prédéfinies de produits)</div>
			<div class="help">@(Chaque ligne seta considéré comme une catégarie.)</div>
		</div>
		<hr />
		<div class="container">
			<h3><i class="fa fa-envelope-o"></i>@(Paramètres SMTP)</h3>
			<div class="row">
				<div class="col-md-6 m">
					<div data-jc="textbox" data-jc-path="form.smtp" data-jc-config="icon:server;placeholder:@(smtp.yourdomain.com)">@(Serveur SMTP)</div>
					<div class="help">@(Adresse ip ou nom de domaine.)</div>
				</div>
				<div class="col-md-6 m">
					<div data-jc="textbox" data-jc-path="form.smtpoptions" data-jc-config="icon:code;placeholder:@(Options SMTP)">@(Options SMTP)</div>
					<div class="help">@(Les options doivent être en format JSON.)</div>
				</div>
			</div>
		</div>
		<br />
	</div>
	<br />

	<div class="container">
		<br />
		<div class="help nmt">@(Liste de tous les administrateurs enrégistrés:)</div>
		<div class="mt5"><a href="javascript:void(0)" class="exec" data-exec="Settings/userCreate"><i class="fa fa-user mr5"></i>@(Ajouter un nouvel administrateur)</a></div>
		<br />
		<table class="table ui-table-grid">
			<tbody data-jc="repeater" data-jc-path="form.users">
				<script type="text/html">
				<tr data-index="{{ index }}">
					<td>{{ name }}</td>
					<td style="width:300px" class="active hidden-xs fs11"><div class="singleline"><i class="fa fa-lock mr5"></i>{{ if roles && roles.length }}{{ roles | join(', ') }}{{ else }}<b class="b">@(Tous les privilèges)</b>{{ fi }}</div></td>
					<td style="width:80px" class="center">
						<button name="edit" title="@(Modifier)" class="exec" data-exec="Settings/userEdit"><i class="fa fa-pencil"></i></button>
						<button name="remove" title="@(Supprimer)" class="exec btn-remove" data-exec="Settings/userRemove"><i class="fa fa-times"></i></button>
					</td>
				</tr>
				</script>
			</tbody>
		</table>
		<hr style="border-color:#D0D0D0" />
		<br />
		<div data-jc="error" data-jc-path="form.response"></div>
		<div class="row">
			<div class="col-md-4 m col-md-offset-4">
				<div data-jc="validation" data-jc-path="form">
					<button class="button b exec" name="submit" disabled="disabled" data-exec="Settings/save">@(ENREGISTRER)</button>
				</div>
			</div>
		</div>
		<br />
	</div>
</div>
<div data-jc="importer" data-jc-path="common.form" data-jc-config="if:settings-admin;url:[url]forms/settings-admin.html" data-jc-controller="Settings"></div>

<script>

	CONTROLLER('Settings', function(ctrl) {

		ctrl.scope = 'settings';

		ctrl.destroy = function() {
			SETTER('sitemap', 'remove', ctrl.scope);
		};

		ctrl.save = function() {

			// Prepare users
			var data = CLONE(ctrl.get('form'));

			data.users = ctrl.get('form').users;

			var tmp = [];
			Object.keys(data.templates).forEach(function(key) {
				tmp.push({ name: key, id: settings.form.templates[key] });
			});
			data.templates = tmp;

			tmp = [];
			Object.keys(data.templatesposts).forEach(function(key) {
				tmp.push({ name: key, id: data.templatesposts[key] });
			});
			data.templatesposts = tmp;

			tmp = [];
			Object.keys(data.templatesproducts).forEach(function(key) {
				tmp.push({ name: key, id: data.templatesproducts[key] });
			});
			data.templatesproducts = tmp;

			tmp = [];
			Object.keys(data.templatesnewsletters).forEach(function(key) {
				tmp.push({ name: key, id: data.templatesnewsletters[key] });
			});
			data.templatesnewsletters = tmp;

			tmp = [];
			Object.keys(data.navigations).forEach(function(key) {
				tmp.push({ name: key, id: data.navigations[key] });
			});
			data.navigations = tmp;

			tmp = [];
			Object.keys(data.posts).forEach(function(key) {
				tmp.push({ name: key, id: data.posts[key] });
			});
			data.posts = tmp;

			tmp = [];
			Object.keys(data.notices).forEach(function(key) {
				tmp.push({ name: key, id: data.notices[key] });
			});
			data.notices = tmp;

			tmp = [];
			Object.keys(data.signals).forEach(function(key) {
				tmp.push({ name: key, id: data.signals[key] });
			});
			data.signals = tmp;

			tmp = [];
			Object.keys(data.languages).forEach(function(key) {
				tmp.push({ name: key, id: data.languages[key] });
			});
			data.languages = tmp;

			SETTER('loading', 'show');
			AJAX('POST [url]api/settings/', data, function(response) {

				SETTER('loading', 'hide', 1000);

				ctrl.set('form.response', response);
				// RESET('settings.form.*');

				if (response instanceof Array)
					return;

				// SET('languages', data.languages);
				// SET('signals', data.signals);

				// success(true);
				// RESET('settings.form.*');
				// EXEC('pages_refresh_dependencies');
				// EXEC('posts_refresh_codelists');

				refresh_dependencies();
				ctrl.reset('form.*');
				SETTER('snackbar', 'success', '@(Les paramètres ont été enregistrés avec succès!.)');
			});
		};

		ctrl.reload = function() {
			AJAX('GET [url]api/settings/', function(response) {

				var tmp = {};
				response.templates && response.templates.forEach(function(item) {
					if (typeof(item) === 'string')
						tmp[item] = item;
					else
						tmp[item.name] = item.id;
				});

				response.templates = tmp;

				tmp = {};
				response.templatesposts && response.templatesposts.forEach(function(item) {
					if (typeof(item) === 'string')
						tmp[item] = item;
					else
						tmp[item.name] = item.id;
				});
				response.templatesposts = tmp;

				tmp = {};
				response.templatesproducts && response.templatesproducts.forEach(function(item) {
					if (typeof(item) === 'string')
						tmp[item] = item;
					else
						tmp[item.name] = item.id;
				});
				response.templatesproducts = tmp;

				tmp = {};
				response.templatesnewsletters && response.templatesnewsletters.forEach(function(item) {
					if (typeof(item) === 'string')
						tmp[item] = item;
					else
						tmp[item.name] = item.id;
				});
				response.templatesnewsletters = tmp;

				tmp = {};
				response.navigations && response.navigations.forEach(function(item) {
					if (typeof(item) === 'string')
						tmp[item] = item;
					else
						tmp[item.name] = item.id;
				});
				response.navigations = tmp;

				tmp = {};
				response.posts && response.posts.forEach(function(item) {
					if (typeof(item) === 'string')
						tmp[item] = item;
					else
						tmp[item.name] = item.id;
				});
				response.posts = tmp;

				tmp = {};
				response.notices && response.notices.forEach(function(item) {
					if (typeof(item) === 'string')
						tmp[item] = item;
					else
						tmp[item.name] = item.id;
				});
				response.notices = tmp;

				tmp = {};
				response.languages && response.languages.forEach(function(item) {
					if (typeof(item) === 'string')
						tmp[item] = item;
					else
						tmp[item.name] = item.id;
				});
				response.languages = tmp;

				tmp = {};
				response.signals && response.signals.forEach(function(item) {
					if (typeof(item) === 'string')
						tmp[item] = item;
					else
						tmp[item.name] = item.id;
				});
				response.signals = tmp;

				ctrl.set('form', response);
			});

		};

		ctrl.userCreate = function() {
			SET('settings.formuser', {}, true);
			SET('common.form', 'settings-admin');
		};

		ctrl.userEdit = function(el) {
			SET('settings.formuser', CLONE(settings.form.users[+el.closest('tr').attrd('index')]), true);
			SET('common.form', 'settings-admin');
		};

		ctrl.userRemove = function(el) {

			var index = +el.closest('tr').attrd('index');
			var users = settings.form.users;
			var user = users[index];

			SETTER('confirm', 'confirm', '@(Etes vous sûr de vouloir supprimer l\'utilistateur <b>"{0}"</b>?)'.format(user.name), ['"times-circle"@(Supprimer)', '@(Non)'], function(index) {
				if (!index) {
					users.splice(index, 1);
					ctrl.update('form.users');
					ctrl.change('form.url', true);
				}
			});
		};

	});

</script>